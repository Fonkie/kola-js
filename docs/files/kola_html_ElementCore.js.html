<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>kola\html\ElementCore.js - kola</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="kola"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Array.html">Array</a></li>
            
                <li><a href="..&#x2F;classes/Class.html">Class</a></li>
            
                <li><a href="..&#x2F;classes/Function.html">Function</a></li>
            
                <li><a href="..&#x2F;classes/Package.html">Package</a></li>
            
                <li><a href="..&#x2F;classes/String.html">String</a></li>
            
                <li><a href="..&#x2F;classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/kola.html">kola</a></li>
            
                <li><a href="..&#x2F;modules/kola.lang.html">kola.lang</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: kola\html\ElementCore.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @fileOverview kola.html.ElementCore dom元素的封装 
 * @author Jady Yang Yuxin Guan
 * @version 2.0.0
 *&#x2F;
kola(&#x27;kola.html.ElementCore&#x27;, 
	[&#x27;kola.lang.Class&#x27;,&#x27;kola.lang.Object&#x27;,&#x27;kola.event.Dispatcher&#x27;,&#x27;kola.css.Selector&#x27;],
function(C, O, Dispatcher, Selector){
    &#x2F;**
        用于element.data的存储
    *&#x2F;
    var cache={};
    var cache_attr_name=&quot;kola&quot; + new Date().getTime();
    var cacheSize=1;
    
    var ElementCore=C.create(Dispatcher,{
        __ME:function(selector, context){
            if(O.isString(selector) &amp;&amp; selector.charAt(0)!=&#x27;&lt;&#x27;){
                &#x2F;&#x2F;	如果为css selector
                var nodes;

                &#x2F;&#x2F;	确认是否存在context
                if(O.isUndefined(context)){
                    context=null;
                }else{
                    context=ElementCore.util.toElements(context);
                    if(context.length==0)
                        context=null;
                }
                &#x2F;&#x2F;	根据有无context进行不同的处理
                if (context === null) {
                    nodes = Selector(selector);
                } else {
                    &#x2F;&#x2F;	context为数组，需要在每个context中寻找
                    &#x2F;&#x2F;	TODO: 这里是有问题的，因为如果selector就是获取第一个，或者指定的某个
                    nodes = [];
                    for (var i = 0, il = context.length; i &lt; il; i ++) {
                        nodes = nodes.concat(Selector(selector, context[i]));
                    }
                }
                return new this(nodes);
            }else{
                var nodes=ElementCore.util.toElements(selector);
            }
            return new this(nodes);
        },
        _init:function(elements){
            this.length=elements.length;
            for(var i=0;i&lt;this.length;i++)
                this[i]=elements[i];
            this._elements = elements;
        },
        &#x2F;*-------------------------------------- data相关 --------------------------------------*&#x2F;
        &#x2F;**
            得到第0个元素的data[name]
            或者设置所有元素的data[name]
        *&#x2F;
        data:function(name,data){
            if(O.isUndefined(data)){
                index=this[0][cache_attr_name];
                if(!index || !cache[index])
                    return null;
                return cache[index][name];
            }else{
                this._each(function(e){
                    index=e[cache_attr_name];
                    if(!index){
                        index=cacheSize++;
                        e[cache_attr_name]=index;
                    }
                    if(!cache[index])
                        cache[index]={};
                    cache[index][name]=data;
                })
            }
        },
        &#x2F;**
            移除所有元素的data[name]
        *&#x2F;
        removeData:function(name){
            this._each(function(e){
                index=e[cache_attr_name];
                if(!index || !cache[index])
                    return;
                cache[index][name]=null;
            });
        },
        &#x2F;**
            移除所有元素的所有data
        *&#x2F;
        removeAllData:function(){
            this._each(function(e){
                index=e[cache_attr_name];
                if(!index)
                    return;
                cache[index]=null;
            });
        },
		&#x2F;*-------------------------------------- 数组相关 --------------------------------------*&#x2F;
		elements: function(){
            return this._elements;
        },
        &#x2F;**
		 * 迭代处理每一个元素
		 *&#x2F;
		each: function( fn ) {
			&#x2F;&#x2F;	使用迭代器循环每个元素
			for ( var i = 0, il = this.length; i &lt; il; i++ ) {
				fn.call( this, this.constructor( this[i] ), i );
			}
			return this;
		},
        &#x2F;*-------------------------------------- KolaElement内部函数 --------------------------------------*&#x2F;
        &#x2F;**
        简单each
        *&#x2F;
        _each:function(callBack){
            for(var i=0,il=this.length;i&lt;il;i++)
                callBack.call(this,this[i]);
        },
        &#x2F;&#x2F;使得浏览器认为实例是一个数组，方便调试
        length:0,
        splice:[].splice
    });
    
    &#x2F;**
	* 将驼峰式转换为css写法
	*&#x2F;
	function hyphenate(name) {
		return name.replace(&#x2F;[A-Z]&#x2F;g, function(match) {
			return &#x27;-&#x27; + match.toLowerCase();
		});
	}
    ElementCore.expando=cache_attr_name;
    ElementCore.util={
        &#x2F;**
         * 获取样式属性
         * @param element
         * @param name
         *&#x2F;
        getComputedStyle : function( element, name ) {
            if (window.getComputedStyle) {
                return window.getComputedStyle(element, null).getPropertyValue(hyphenate(name));
            }
            if (document.defaultView &amp;&amp; document.defaultView.getComputedStyle) {
                var computedStyle = document.defaultView.getComputedStyle(element, null);
                if (computedStyle) return computedStyle.getPropertyValue(hyphenate(name));
                if (name == &quot;display&quot;) return &quot;none&quot;;
            }
            if (element.currentStyle) {
                return element.currentStyle[name];
            }
            return element.style[name];
        },
        &#x2F;**
        得到元素数组
            Array[element] :不变
            element：[element]
            kolaElement:kolaElement的_elements
            String(html):转换成element
        *&#x2F;
        toElements : function(selector){
            if(O.isArray(selector)){
                return selector;
            }
            if(O.isString(selector)){
                &#x2F;&#x2F;	如果为html
                var ctr = document.createElement(&#x27;div&#x27;);
                ctr.innerHTML = selector;
                var arr=[];
                for(var i=ctr.children.length-1;i&gt;=0;i--){
                    arr[i]=ctr.children[i];
                }
                ElementCore.fire({type:&quot;DOMNodeInserted&quot;,data:arr});
                return arr;
            }
            &#x2F;&#x2F; 如果是window
            if(selector==window)
                return [selector];
            &#x2F;&#x2F;	如果为kola.html.Element
            if ( selector instanceof ElementCore )
                return selector.elements();
            
            
            &#x2F;&#x2F;	如果为DOMLElement
            if (selector.nodeType === 1) 
                return [selector];
            if(selector.nodeType === 9){
                if(selector.documentElement)
                    selector=selector.documentElement;
                return [selector];
            }
            &#x2F;&#x2F;	如果为HTMLCollection的话，那就返回之
            if (!O.isUndefined(selector.length)) {
            	var array = [];
            	for (var i = 0, il = selector.length; i &lt; il; i++) {
                    if(selector[i].nodeType === 1)
                        array.push(selector[i]);
            	}
            	return array;
            }
        }
    };
    return ElementCore;
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="../../../src/kola/Packager.js"></script>
	<script type="text/javascript" src="../../testsuit/testSuit.js"></script>
</head>
<body>
	<script>
		kola("kola.lang.Array",function(KolaArray){
			var testArrNum = [1, 2, 3, 4, 5, 6, 4, 3, 2, 1];
			var testArrString = ["alpha", "beta", "gamma", "delta", "gamma", "beta", "alpha"];
			test("indexOf",function(testCase){
				testCase(KolaArray.indexOf(testArrNum, 4) == 3, "数字数组");
				testCase(KolaArray.indexOf(testArrNum, '1') == -1, "数字数组不存在");
				testCase(KolaArray.indexOf(testArrString, "delta") == 3, "字符串数组");
				testCase(KolaArray.indexOf(testArrString, 'omega') == -1, "字符串数组不存在");

				testCase(KolaArray.indexOf(testArrNum, 4, 4) == 6, "数字数组+fromIndex");
				testCase(KolaArray.indexOf(testArrNum, 4, -10) == 3, "数字数组不存在+(-fromIndex)");
				testCase(KolaArray.indexOf(testArrString, "delta", 4) == -1, "字符串数组+fromIndex");
				testCase(KolaArray.indexOf(testArrString, 'delta', -6) == 3, "字符串数组+(-fromIndex)");
			});

			test("lastIndexOf",function(testCase){
				testCase(KolaArray.lastIndexOf(testArrNum, 4) == 6, "数字数组测试");
				testCase(KolaArray.lastIndexOf(testArrNum, '1') == -1, "数字数组不存在测试");
				testCase(KolaArray.lastIndexOf(testArrString, "gamma") == 4, "字符串数组测试");
				testCase(KolaArray.lastIndexOf(testArrString, 'omega') == -1, "字符串数组不存在测试");

				testCase(KolaArray.lastIndexOf(testArrNum, 4, 4) == 3, "数字数组+fromIndex");
				testCase(KolaArray.lastIndexOf(testArrNum, 4, -6) == 3, "数字数组不存在+(-fromIndex)");
				testCase(KolaArray.lastIndexOf(testArrString, "gamma", 4) == 4, "字符串数组+fromIndex");
				testCase(KolaArray.lastIndexOf(testArrString, 'gamma', -6) == -1, "字符串数组+(-fromIndex)");

				testCase(KolaArray.lastIndexOf(testArrString, 'gamma', "wrong start") == -1, "lastindexof start类型不对应该认为从第0个开始，而非最后一个");
			});

			test("every",function(testCase){
				var scope = {scopeName : "alpha"};
				testCase(KolaArray.every(testArrNum, function(item, i, target){
					return(item > 3);
				}) == false, "部分成立");

				testCase(KolaArray.every(testArrNum, function(item, i, target){
					return(item > 0);
				}), "全部成立");

				var index=0;
				testCase(KolaArray.every(testArrNum, function(item, i, target){
					return(index++ == i);
				}), "index");

				testCase(KolaArray.every(testArrNum, function(item, i, target){
					return(this.scopeName.length);
				}, scope), "scope");

				testCase(KolaArray.every([1,1,undefined,1,1], function(item, i, target){
					return(item == 1);
				}) == false, "有定义过的undefined");
				var testArr=[]
				testArr[2] = 1;
				testArr[8] = 1;
				testCase(KolaArray.every(testArr, function(item, i, target){
					return(item == 1);
				}), "有未定义过的undefined");
			});

			test("some",function(testCase){
				testCase(KolaArray.some(testArrNum, function(item, i, target){
					return(item > 3);
				}), "部分成立");

				testCase(KolaArray.some(testArrNum, function(item, i, target){
					return(item < 0);
				}) == false, "全部不成立");
			});

			test("forEach",function(testCase){
				var sum = 0;
				KolaArray.forEach(testArrNum, function(item, i, target){
					sum += item;
				});
				testCase(sum == 31, "和");
			});

			test("reduce",function(testCase){
				testCase(KolaArray.reduce(testArrNum, function(prev, item, i, target){
					return prev + item;
				}) == 31, "和");
			});

			test("map",function(testCase){
				var newArray = KolaArray.map(testArrNum, function(item, i, target){
					return item + i;
				});
				testCase(KolaArray.every(testArrNum, function(item, i, target){
					return newArray[i] == item + i;
				}), "和");
			});

			test("parse",function(testCase){
				var likeArray = {}
				likeArray[0] = 0;
				likeArray.length = 1;
				var testArray = KolaArray.parse(likeArray);
				testCase(testArray.length == 1 && testArray[0] == 0, "object转数组");
			});
		});
	</script>
</body>
</html>